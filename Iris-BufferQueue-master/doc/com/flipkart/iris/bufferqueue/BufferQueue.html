<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_67) on Fri Jun 19 00:21:54 IST 2015 -->
<title>BufferQueue</title>
<meta name="date" content="2015-06-19">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="BufferQueue";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/BufferQueue.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev Class</li>
<li><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/flipkart/iris/bufferqueue/BufferQueue.html" target="_top">Frames</a></li>
<li><a href="BufferQueue.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.flipkart.iris.bufferqueue</div>
<h2 title="Interface BufferQueue" class="title">Interface BufferQueue</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Known Implementing Classes:</dt>
<dd><a href="../../../../com/flipkart/iris/bufferqueue/mmapped/MappedBufferQueue.html" title="class in com.flipkart.iris.bufferqueue.mmapped">MappedBufferQueue</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="strong">BufferQueue</span></pre>
<div class="block">An API for a queue that is intended to be used as a local
 buffer for data before it is sent to remote systems. <br/><br/>

 Publishing and consumption must be completely thread-safe. <br/><br/>

 Each entry in a <code>BufferQueue</code> is represented by
 a <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue"><code>BufferQueueEntry</code></a>. <br/><br/>

 Enqueuing/publishing data to the queue is a 3-step process:
 <ol>
      <li>"Claim" a new entry using the method <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#next()"><code>next()</code></a></li>
      <li>Write the data to the returned <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue"><code>BufferQueueEntry</code></a> using any method that it offers</li>
      <li>Mark the entry as published by calling <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html#markPublished()"><code>BufferQueueEntry.markPublished()</code></a></li>
 </ol>

 Alternatively, calling <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#publish(byte[])"><code>publish(byte[] data)</code></a> will
 internally do all these steps automatically. <br/><br/>

 Multiple <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#next()"><code>next()</code></a>/<a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#publish(byte[])"><code>publish(byte[] data)</code></a> calls could
 be happening in parallel and entries must be made available for consumption
 in the order in which they were claimed. <br/><br/>

 Dequeueing/consuming data from the queue is also a 3-step process:
 <ol>
      <li>Get the next entry to be consumed from the queue by calling <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#consume()"><code>consume()</code></a></li>
      <li>Read and consume the data from the returned <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue"><code>BufferQueueEntry</code></a></li>
      <li>Mark the entry as consumed by calling <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html#markConsumed()"><code>BufferQueueEntry.markConsumed()</code></a></li>
 </ol>

 Consumption using the above process will be ordered -- messages will be
 consumed in the same order in which they were claimed/published. Until a message is
 marked as consumed, the next message will not be returned. Thus it does not
 make sense to consume in parallel -- the same entry will be delivered to multiple
 queues. <br/><br/>

 There is also a batch consume API in the form of the method <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#consume(int)"><code>consume(int n)</code></a>
 that allows consumption of multiple entries (up to <code>n</code>) at the same time.
 This can also be used to parallelize consumption -- get a batch of entries and then
 hand them off to a separate set of worker threads to process. Please note that this
 would imply that entries would be processed out-of-order. <br/></div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue"><code>BufferQueueEntry</code></a></dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#capacity()">capacity</a></strong>()</code>
<div class="block">BufferQueue implementations may have a upper limit on the number of
 unconsumed messages they will hold.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>com.google.common.base.Optional&lt;<a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue">BufferQueueEntry</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#consume()">consume</a></strong>()</code>
<div class="block">Return the next consumable entry from the BufferQueue.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue">BufferQueueEntry</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#consume(int)">consume</a></strong>(int&nbsp;n)</code>
<div class="block">Return the next (up to) <code>n</code> consumable entries from the BufferQueue.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#isEmpty()">isEmpty</a></strong>()</code>
<div class="block">Check if the BufferQueue has any consumable entries.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#isFull()">isFull</a></strong>()</code>
<div class="block">Check if the BufferQueue is "full" that is if it has any more
 capacity to accept newer entries before any more entries are
 consumed.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><strong><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#maxDataLength()">maxDataLength</a></strong>()</code>
<div class="block">BufferQueue implementations may have a max size of data that they accept.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>com.google.common.base.Optional&lt;<a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue">BufferQueueEntry</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#next()">next</a></strong>()</code>
<div class="block">Claim the next entry in the buffer queue.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#publish(byte[])">publish</a></strong>(byte[]&nbsp;data)</code>
<div class="block">A higher level helper method to do all the 3-steps of publishing
 to the BufferQueue in a single method call.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#size()">size</a></strong>()</code>
<div class="block">Returns the number of unconsumed entries that this BufferQueue currently
 holds.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="next()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>next</h4>
<pre>com.google.common.base.Optional&lt;<a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue">BufferQueueEntry</a>&gt;&nbsp;next()</pre>
<div class="block">Claim the next entry in the buffer queue. <br/>

 Important: The publisher **must** call <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html#markPublished()"><code>BufferQueueEntry.markPublished()</code></a>
 on the returned <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue"><code>BufferQueueEntry</code></a>, otherwise no consumer
 will be able to move past this point. <br/><br/>

 <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html#markPublished()"><code>BufferQueueEntry.markPublished()</code></a> **must** be called even if writing data
 to the buffer failed. It is recommended that this method be called in a
 <code>finally</code> block; for example:

 <pre>
 <code>
      BufferQueueEntry entry = bufferQueue.next();
      try {
          // entry.set(data);
      }
      finally {
          entry.markPublished();
      }
 </code>
 </pre></div>
<dl><dt><span class="strong">Returns:</span></dt><dd>The claimed entry. The reference will be absent in the Optional
          if claiming failed (may happen if the buffer is full, for example).</dd><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html#markPublished()"><code>BufferQueueEntry.markPublished()</code></a></dd></dl>
</li>
</ul>
<a name="publish(byte[])">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>publish</h4>
<pre>boolean&nbsp;publish(byte[]&nbsp;data)
                throws <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/BufferOverflowException.html?is-external=true" title="class or interface in java.nio">BufferOverflowException</a></pre>
<div class="block">A higher level helper method to do all the 3-steps of publishing
 to the BufferQueue in a single method call. This claims a new entry,
 writes data to the entry and then marks it as published.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>data</code> - The data to publish as an entry.</dd>
<dt><span class="strong">Returns:</span></dt><dd></dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="http://docs.oracle.com/javase/7/docs/api/java/nio/BufferOverflowException.html?is-external=true" title="class or interface in java.nio">BufferOverflowException</a></code> - If the given data does not fit in a single entry.</dd><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#next()"><code>next()</code></a></dd></dl>
</li>
</ul>
<a name="consume()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>consume</h4>
<pre>com.google.common.base.Optional&lt;<a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue">BufferQueueEntry</a>&gt;&nbsp;consume()</pre>
<div class="block">Return the next consumable entry from the BufferQueue. <br/><br/>

 Note that until the returned entry is marked as consumed, the same
 entry will be returned for each call, even if different threads make
 the call. <br/><br/>

 Thus consumers **must** call <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html#markConsumed()"><code>BufferQueueEntry.markConsumed()</code></a> on the returned
 <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue"><code>BufferQueueEntry</code></a>. It is recommended that this method be
 called in a <code>finally</code> block; for example:

 <pre>
 <code>
      BufferQueueEntry entry = bufferQueue.consume();
      try {
          // consume the data from entry
      }
      finally {
          entry.markConsumed();
      }
 </code>
 </pre></div>
<dl><dt><span class="strong">Returns:</span></dt><dd>The consumable <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue"><code>BufferQueueEntry</code></a>, null if
          no consumable entries are currently available or if the next
          entry is corrupted for any unknown reason.</dd><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html#markConsumed()"><code>BufferQueueEntry.markConsumed()</code></a></dd></dl>
</li>
</ul>
<a name="consume(int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>consume</h4>
<pre><a href="http://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util">List</a>&lt;<a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue">BufferQueueEntry</a>&gt;&nbsp;consume(int&nbsp;n)</pre>
<div class="block">Return the next (up to) <code>n</code> consumable entries from the BufferQueue. <br/><br/>

 Less than <code>n</code> entries (including <code>zero</code> entries) may be
 returned based on how many entries are currently available. <br/><br/>

 The same set of contracts as specified in <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#consume()"><code>consume()</code></a> apply to this
 method as well. <br/><br/>

 The returned messages may be marked as consumed out of order. This allows the
 consumer to parallelize consumption of the messages (over a thread-pool, for
 example).</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>n</code> - The number of entries to return.</dd>
<dt><span class="strong">Returns:</span></dt><dd>A list of up to <code>n</code> entries.</dd><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#consume()"><code>consume()</code></a></dd></dl>
</li>
</ul>
<a name="maxDataLength()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>maxDataLength</h4>
<pre>int&nbsp;maxDataLength()</pre>
<div class="block">BufferQueue implementations may have a max size of data that they accept.
 Attempting to data with sizes greater than this will result in a
 <a href="http://docs.oracle.com/javase/7/docs/api/java/nio/BufferOverflowException.html?is-external=true" title="class or interface in java.nio"><code>BufferOverflowException</code></a>.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>The maximum length of data this BufferQueue can accomodate.</dd></dl>
</li>
</ul>
<a name="capacity()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>capacity</h4>
<pre>long&nbsp;capacity()</pre>
<div class="block">BufferQueue implementations may have a upper limit on the number of
 unconsumed messages they will hold. This limit is referred to as its
 capacity.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>The max number of unconsumed messages this BufferQueue will hold.</dd></dl>
</li>
</ul>
<a name="size()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>size</h4>
<pre>long&nbsp;size()</pre>
<div class="block">Returns the number of unconsumed entries that this BufferQueue currently
 holds. <br/><br/>

 This number may be returned on a "best-effort" basis and may only be
 indicative instead of being accurate. This happens mainly because there
 may be claimed but as yet unpublished entries as well as entries that
 have been marked as consumed out of order (when using bulk consumption).</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>The current -- approximate -- size of the queue.</dd></dl>
</li>
</ul>
<a name="isFull()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isFull</h4>
<pre>boolean&nbsp;isFull()</pre>
<div class="block">Check if the BufferQueue is "full" that is if it has any more
 capacity to accept newer entries before any more entries are
 consumed. <br/><br/>

 For certain implementations of BufferQueue it may be more efficient
 to call this method than call figure this out by calling
 <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#capacity()"><code>capacity()</code></a> and <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#size()"><code>size()</code></a>.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd><code>true</code> if the BufferQueue is full, <code>false</code> otherwise</dd><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#capacity()"><code>capacity()</code></a></dd></dl>
</li>
</ul>
<a name="isEmpty()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>isEmpty</h4>
<pre>boolean&nbsp;isEmpty()</pre>
<div class="block">Check if the BufferQueue has any consumable entries. This may be
 an approximation and it is possible that even if this returns true
 there are no consumable entries or vice versa. <br/>

 For certain implementations of BufferQueue it may be more efficient
 to call this method than call figure this out by calling <a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#size()"><code>size()</code></a>.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd><code>true</code> if the BufferQueue is empty, <code>false</code> otherwise</dd><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueue.html#size()"><code>size()</code></a></dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/BufferQueue.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev Class</li>
<li><a href="../../../../com/flipkart/iris/bufferqueue/BufferQueueEntry.html" title="class in com.flipkart.iris.bufferqueue"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?com/flipkart/iris/bufferqueue/BufferQueue.html" target="_top">Frames</a></li>
<li><a href="BufferQueue.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
